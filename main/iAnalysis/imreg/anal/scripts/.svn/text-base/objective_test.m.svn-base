cd '/Users/speron/sci/imaging/2011_02_17_objectives';

% Olympus 1-4: use 3,4 ; 16x zoon, 3: collar OFF ; 4: collar ON ; dz =0.5 always
% beads under 2 160 um coverslips glued together

%% Olympus, collar OFF
if (~exist('im_O'))
	im_O = load_image('Olympus25X_16xzoom_dzp50_003.tif');
end
zero_z_O = 37;
pix2um = [25/256 25/256 0.5];
bead_coords_O = [191 127 120; ...
              219 150 100; ...
              139 124 50; ...
              232 71 150; ...
              122 94 60; ...
              202 199 80 ; ...
							126 98 250; ...
							37 157 250; ...
							158 182 250; ...
							158 182 250; ...
							177 77 300; ...
							65 60 400; ...
							48 204 460;...
							214 182 460; ...
							115 178 520 ; ...
							173 200 520 ; ...
							102 134 560 ; ...
							61 57 600 ; ...
  						226 150 200]';
psf_O = psf_measure(im_O, pix2um, bead_coords_O);

%% Olympus, collar ON
zero_z_Oc = 83;
if (~exist('im_Oc'))
	im_Oc = load_image('Olympus25X_16xzoom_dzp50_004.tif');
end
bead_coords_Oc = [87 149 630; ...
              140 149 600 ; ...
							215 198 600 ; ...
							73 97 540 ; ...
							160 49 540 ; ...
							109 79 450 ; ...
							145 160 400 ; ...
							56 163 420 ; ...
							39 215 350 ; ...
							101 61 350 ; ...
							82 176 300 ; ...
							172 121 300 ; ...
							185 164 250 ; ...
							52 109 260 ; ...
							82 46 260 ; ...
              141 142 200 ; ...
							225 103 200 ; ...
							113 84 150 ; ...
							219 91 150 ; ...
							165 106 100 ; ...
							162 182 100 ; ...
  						113 88 500]'; 
psf_Oc = psf_measure(im_Oc, pix2um, bead_coords_Oc);

%% Nikkon 16X 0.8 NA
pix2um = [30/256 30/256 0.5];
zero_z_N = 65;
if (~exist('im_N'))
	im_N = load_image('Nikon16X_25xzoom_dzp50_001.tif');
end
bead_coords_N = [171 126 61 ; ...
              78 105 61; ...
							150 183 90; ...
							145 108 90; ...
              97 75 140 ; ...
							138 146 140 ; ...
							141 116 200; ...
							117 73 250 ; ...
							212 152 250 ; ...
							108 85 310 ; ...
							81 129 310 ; ...
							52 156 350 ; ...
							85 94 350 ; ...
							209 76 410 ; ...
							74 94 420 ; ...
              95 63 460; ...
							65 182 500 ; ...
							42 154 500 ; ...
							78 98 500 ; ...
							91 50 500 ; ...
							20 140 550 ; ...
							176 191 550 ; ...
							64 140 600 ; ...
							151 108 600 ; ...
  						128 44 200]'; 
psf_N = psf_measure(im_N, pix2um, bead_coords_N);

mu_Oc = nanmean(psf_Oc,2);
mu_O = nanmean(psf_O,2);
mu_N = nanmean(psf_N,2);

subplot(2,2,1);
Z = (bead_coords_Oc(3,:)-zero_z_Oc)*pix2um(3);
plot(Z, psf_Oc(3,:), 'rx');
hold on ;
Z = (bead_coords_O(3,:)-zero_z_O)*pix2um(3);
plot(Z, psf_O(3,:), 'bx');
Z = (bead_coords_N(3,:)-zero_z_N)*pix2um(3);
plot(Z, psf_N(3,:), 'gx');
set(gca,'TickDir', 'out');
xlabel('depth (um)');
ylabel ('axial FWHM (um)');
a=axis; 
axis([0 300 a(3) a(4)]); a = axis;
plot((a(2)-a(1))/2, mu_Oc(3), 'ro', 'MarkerFaceColor', [1 0 0]);
plot((a(2)-a(1))/2, mu_O(3), 'bo', 'MarkerFaceColor', [0 0 1]);
plot((a(2)-a(1))/2, mu_N(3), 'go', 'MarkerFaceColor', [0 1 0]);

subplot(2,2,2);
Z = (bead_coords_Oc(3,:)-zero_z_Oc)*pix2um(3);
plot(Z, psf_Oc(1,:), 'rx');
hold on ;
plot(Z, psf_Oc(2,:), 'rx');
Z = (bead_coords_O(3,:)-zero_z_O)*pix2um(3);
plot(Z, psf_O(2,:), 'bx');
plot(Z, psf_O(1,:), 'bx');
Z = (bead_coords_N(3,:)-zero_z_N)*pix2um(3);
plot(Z, psf_N(2,:), 'gx');
plot(Z, psf_N(1,:), 'gx');
set(gca,'TickDir', 'out');
xlabel('depth (um)');
ylabel ('lateral FWHM (um)');
a=axis; 
axis([0 300 a(3) a(4)]); a = axis;
plot((a(2)-a(1))/2, (mu_Oc(2)+mu_Oc(1))/2, 'ro', 'MarkerFaceColor', [1 0 0]);
plot((a(2)-a(1))/2, (mu_O(1)+mu_O(2))/2, 'bo', 'MarkerFaceColor', [0 0 1]);
plot((a(2)-a(1))/2, (mu_N(2)+mu_N(1))/2, 'go', 'MarkerFaceColor', [0 1 0]);

subplot(2,2,3);
plot(1,1,'rx');
hold on;
plot(1,1,'bx');
plot(1,1,'gx');

legend('Olympus 25 X 1.05 NA, collar ON', 'Olympus, collar OFF', 'Nikkon 16 X 0.8 NA');



