function [data] = Collect_phase_summary()
% [collected_meanRespPref_summary_stats,data] = Collect_meanResp_summary(PrefLocFixed)

count=0;

filename = '';
while(count>=0)
    if strcmp(filename, '');
        [filename,pathName]=uigetfile('*_pooled_contactCaTrials_phasedep*.mat','Load fitmean.mat file');
    else
        [filename,pathName]=uigetfile(filename,'Load phasedep.mat file');
    end
    if isequal(filename, 0) || isequal(pathName,0)
        break
    end
    count=count+1;
    load( [pathName filesep filename], '-mat');
    obj = pooled_contactCaTrials_locdep;
    dends = size(obj,2);
    for d =1:dends
        
        PPI_ctrl{count}(d,1) = pooled_contactCaTrials_locdep{d}.phase.PPI_NL;
        meanResp_phase_ctrl{count}(d,:) = pooled_contactCaTrials_locdep{d}.phase.mResp_NL;
        normResp_phase_ctrl{count}(d,:) = pooled_contactCaTrials_locdep{d}.phase.normResp_NL;
        [v,i]=max(pooled_contactCaTrials_locdep{1}.phase.normResp_NL);
        PPid_ctrl{count}(d,1) = i;
        PPh_ctrl{count}(d,1) = pooled_contactCaTrials_locdep{1}.phase.touchPhase_mid(i);
        
        
        if isfield( pooled_contactCaTrials_locdep{1}.phase,'PPI_L')
        PPI_mani{count}(d,1) = pooled_contactCaTrials_locdep{d}.phase.PPI_L;
        meanResp_phase_mani{count}(d,:) = pooled_contactCaTrials_locdep{d}.phase.mResp_L;
        normResp_phase_mani{count}(d,:) = pooled_contactCaTrials_locdep{d}.phase.normResp_L;
        [v,i]=max(pooled_contactCaTrials_locdep{1}.phase.normResp_L);
        PPid_mani{count}(d,1) = i;
        PPh_mani{count}(d,1) = pooled_contactCaTrials_locdep{1}.phase.touchPhase_mid(i);
        end
        
    end
    
    cd (pathName);
end
data.PPI_ctrl=PPI_ctrl;


if isfield( pooled_contactCaTrials_locdep{1}.phase,'PPI_L')

end
folder = uigetdir;
cd (folder);
save('Fitmean Summary Data','data');
save('collected_fitmean_summary_stats','collected_fitmean_summary_stats');
%% adding Norm SLopes wrt ctrl mean and at the ctrl Prefered Loc

num_sessions = size(data.Slopes_ctrl,2);

for sess = 1: num_sessions
    num_dends = size(data.Slopes_ctrl{sess},1);
    mean_SlopesCTRL = mean(data.Slopes_ctrl{sess},2);
    tempmat = repmat(mean_SlopesCTRL,1,size(data.Slopes_ctrl{sess},2));
    data.NormSlopesnCTRL_ctrl{sess}=data.Slopes_ctrl{sess}./tempmat;
    if isfield(data,'LPI_mani')
        data.NormSlopesnCTRL_mani{sess}=data.Slopes_mani{sess}./tempmat;
    end
    
    if isfield(data,'LPI_mani')
        if ~PrefLocFixed
            [val,ind] = max(data.NormSlopesnCTRL_mani{sess}');
            data.LPInCTRL_mani{sess} = val';
        end
    end
    [val,ind] = max(data.NormSlopesnCTRL_ctrl{sess}');
    data.LPInCTRL_ctrl{sess} = val';
    
    if isfield(data,'LPI_mani')
        if PrefLocFixed
            for d = 1:num_dends
                data.LPInCTRL_mani{sess}(d,1) = data.NormSlopesnCTRL_mani{sess}(d,ind(d));
            end
        end
        
        
        [maxval,maxind] = max(data.meanResp_mani{sess}');
        [minval,minind] = min(data.meanResp_mani{sess}');
        data.diffmeanResp_mani{sess} = (maxval-minval)';
        if ~PrefLocFixed
            data.meanRespPrefLoc_mani{sess} = maxval';
        end
        [maxval,maxind] = max(data.meanResp_ctrl{sess}');
        [minval,minind] = min(data.meanResp_ctrl{sess}');
        data.diffmeanResp_ctrl{sess} = (maxval-minval)';
        data.meanRespPrefLoc_ctrl{sess} = maxval';
        if PrefLocFixed
            for d = 1:num_dends
                data.meanRespPrefLoc_mani{sess}(d,1) = data.meanResp_mani{sess}(d,maxind(d));
            end
            
        end
    else
        [maxval,maxind] = max(data.meanResp_ctrl{sess}');
        [minval,minind] = min(data.meanResp_ctrl{sess}');
        data.diffmeanResp_ctrl{sess} = (maxval-minval)';
        data.meanRespPrefLoc_ctrl{sess} = maxval';     
        
    end
    
    
end

% data.info=info;
folder = uigetdir;
cd (folder);
save('Fitmean Summary Data','data');
save('collected_fitmean_summary_stats','collected_fitmean_summary_stats');

